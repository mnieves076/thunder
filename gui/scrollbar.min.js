Thunder.Scrollbar=Thunder.Component.extend({init:function(t,e,s,i,a,n){this._super(t),this.horizontal=null!==n&&n,null!==s?this.assetManager=s:this.assetManager=this.getScrollbarAssetManager(),this.width=i,this.height=a,this.value=0,this.fireUpdateOnSetValue=!0,this.scrollTimer=null,this.min=0,this.max=1,this.tabSegment=0,this.increment=10,this.rectMouseDownOffSet=null,this.dragTab=!1,this.name=e,this.tag="PARENT",this.layerManager.addLayer("/GUI"),new Thunder.EventMap(this.container,this,this.eventQueue);var h=this;document.addEventListener("mouseup",function(t){if(h.dragTab)return h.eventQueue.addEvent("WINDOW_MOUSEUP",0,h,t),!1}),document.addEventListener("mousemove",function(t){if(h.dragTab)return h.eventQueue.addEvent("WINDOW_MOUSEMOVE",0,h,t),!1}),this.drawMainInterface()},drawMainInterface:function(){var t=this;this.addResponder("MOUSEDOWN",function(e){switch(t.trace("SCROLLBAR EVENT: "+e.name+": "+e.owner.tag),e.owner.tag){case"UP":null===t.scrollTimer&&(t.scrollTimer=setInterval(function(){t.handleButton(-1*t.increment)},20));break;case"DOWN":null===t.scrollTimer&&(t.scrollTimer=setInterval(function(){t.handleButton(t.increment)},20));break;case"RECT":case"TAB":t.dragTab=!0}}),this.addResponder("MOUSEUP",function(e){switch(t.trace("SCROLLBAR EVENT: "+e.name+": "+e.owner.tag),null!==t.scrollTimer&&(clearInterval(t.scrollTimer),t.scrollTimer=null),t.dragTab=!1,e.owner.tag){case"UP":t.handleButton(-1*t.increment);break;case"DOWN":t.handleButton(t.increment);break;case"RECT":t.dragTab=!1,t.horizontal?t.rectMouseDownOffSet=e.getLocalEventPosition().x:t.rectMouseDownOffSet=e.getLocalEventPosition().y,t.handleDrag()}}),this.addResponder("MOUSELEAVE",function(e){switch(t.trace("SCROLLBAR EVENT: "+e.name+": "+e.owner.tag),e.owner.tag){case"UP":case"DOWN":null!==t.scrollTimer&&(clearInterval(t.scrollTimer),t.scrollTimer=null)}}),this.addResponder("WINDOW_MOUSEUP",function(e){t.trace("SCROLLBAR EVENT: "+e.name+": "+e.owner.tag),null!==t.scrollTimer&&(clearInterval(t.scrollTimer),t.scrollTimer=null),t.dragTab=!1}),this.addResponder("WINDOW_MOUSEMOVE",function(e){if(t.trace("SCROLLBAR EVENT: "+e.name+": "+e.owner.tag),t.dragTab){var s=t.assetManager.getAsset("TAB");t.horizontal?t.rectMouseDownOffSet=e.getLocalEventPosition().x-s.getWidth()/2:t.rectMouseDownOffSet=e.getLocalEventPosition().y-s.getHeight()/2,t.handleDrag()}}),this.addCustomizer("btn",function(e){switch(e.attach("<img src='"+e.src+"' style='cursor:hand;cursor:pointer'/>"),new Thunder.EventMap(e.container.firstChild,e,t.eventQueue),e.tag){case"DOWN":t.horizontal?e.setPosition(t.width-e.width,0):e.setPosition(0,t.height-e.height);break;case"TAB":var s=t.assetManager.getAsset("UP");t.horizontal?e.setPosition(s.getX()+s.getWidth(),0):e.setPosition(0,s.getY()+s.getHeight());break;case"RECT":var s=t.assetManager.getAsset("UP"),i=t.assetManager.getAsset("DOWN");t.horizontal?(e.width=t.width-(s.getWidth()+i.getWidth()),e.setPosition(s.getWidth(),0),e.container.firstChild.style.width=e.getWidth(),e.container.firstChild.style.height=t.height):(e.height=t.height-(s.getHeight()+i.getHeight()),e.setPosition(0,s.getHeight()),e.container.firstChild.style.width=t.width,e.container.firstChild.style.height=e.getHeight())}}),this.layerManager.layOut(this.assetManager.getAssets("gui","btn|mask"),"/GUI"),this.setTabSegment()},handleDrag:function(){var t=this.assetManager.getAsset("RECT"),e=this.assetManager.getAsset("TAB");if(this.horizontal){this.rectMouseDownOffSet<t.getX()&&(this.rectMouseDownOffSet=t.getX());for(var s=t.getX(),i=s+this.tabSegment,a=e.getWidth()/2,n=this.min;n<this.max;n++){if(this.rectMouseDownOffSet>=s-a&&this.rectMouseDownOffSet<=i+a&&this.value!==n){this.value=n,e.setX(this.rectMouseDownOffSet),this.adjustTabPosition(),this.broadcastEvent("SCROLL_UPDATE");return}(s+=this.tabSegment)>=t.getWidth()&&(s=t.getWidth()),i=s+this.tabSegment}}else{this.rectMouseDownOffSet<t.getY()&&(this.rectMouseDownOffSet=t.getY());for(var s=t.getY(),i=s+this.tabSegment,h=e.getHeight()/2,n=this.min;n<this.max;n++){if(this.rectMouseDownOffSet>=s-h&&this.rectMouseDownOffSet<=i+h&&this.value!==n){this.value=n,e.setY(this.rectMouseDownOffSet),this.adjustTabPosition(),this.broadcastEvent("SCROLL_UPDATE");return}(s+=this.tabSegment)>=t.getHeight()&&(s=t.getHeight()),i=s+this.tabSegment}}this.value!==this.max&&(this.value=this.max,this.adjustTabPosition(),this.broadcastEvent("SCROLL_UPDATE"))},handleButton:function(t){if(this.value!==this.max&&t>0||this.value!==this.min&&t<0){this.value+=t,this.value>this.max?this.value=this.max:this.value<this.min&&(this.value=this.min);var e=this.tabSegment*t,s=this.assetManager.getAsset("TAB");this.horizontal?s.setX(s.getX()+e):s.setY(s.getY()+e),this.adjustTabPosition(),this.broadcastEvent("SCROLL_UPDATE")}},setTabSegment:function(){this.horizontal?this.tabSegment=(this.assetManager.getAsset("RECT").getWidth()-this.assetManager.getAsset("TAB").width)/(this.max-this.min):this.tabSegment=(this.assetManager.getAsset("RECT").getHeight()-this.assetManager.getAsset("TAB").height)/(this.max-this.min)},adjustTabPosition:function(){var t=this.assetManager.getAsset("RECT"),e=this.assetManager.getAsset("TAB");if(this.horizontal){var s=t.getX(),i=t.getX()+t.getWidth()-e.getWidth();e.getX()<=s&&(e.setX(s),this.value=this.min),e.getX()>=i&&(e.setX(i),this.value=this.max)}else{var s=t.getY(),i=t.getY()+t.getHeight()-e.getHeight();e.getY()<=s&&(e.setY(s),this.value=this.min),e.getY()>=i&&(e.setY(i),this.value=this.max)}},getValue:function(){return this.value},setValue:function(t){if(!isNaN(t)){if(this.horizontal)var e=this.assetManager.getAsset("RECT").getX();else var e=this.assetManager.getAsset("RECT").getY();t>this.max&&(t=this.max),t<this.min&&(t=this.min),this.value=t,null===this.scrollTimer&&(this.horizontal?this.assetManager.getAsset("TAB").setX(e+(this.value-this.min)*this.tabSegment):this.assetManager.getAsset("TAB").setY(e+(this.value-this.min)*this.tabSegment)),this.adjustTabPosition(),this.fireUpdateOnSetValue&&this.broadcastEvent("SCROLL_UPDATE")}},getMin:function(){return this.min},setMin:function(t){this.min=t,this.setTabSegment(),this.value<this.min?this.setValue(this.min):this.adjustTabPosition()},getMax:function(){return this.max},setMax:function(t){this.max=t,this.setTabSegment(),this.value>this.max?this.setValue(this.max):this.adjustTabPosition()},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(t){this.width!==t&&(this.width=t,this.drawMainInterface())},setHeight:function(t){this.height!==t&&(this.height=t,this.drawMainInterface())},setIncrement:function(t){this.increment=t},getIncrement:function(){return increment},setFireUpdateOnSetValue:function(t){this.fireUpdateOnSetValue=t},getScrollbarAssetManager:function(){var t=new Thunder.AssetManager;return t.addAsset("gui","btn",Thunder.ROOT+"/gui/images/scroll_rect.png","RECT"),t.addAsset("gui","btn",Thunder.ROOT+"/gui/images/scroll_tab.png","TAB",0,0,16,16),this.horizontal?(t.addAsset("gui","btn",Thunder.ROOT+"/gui/images/scroll_left.png","UP",0,0,16,16),t.addAsset("gui","btn",Thunder.ROOT+"/gui/images/scroll_right.png","DOWN",0,0,16,16)):(t.addAsset("gui","btn",Thunder.ROOT+"/gui/images/scroll_up.png","UP",0,0,16,16),t.addAsset("gui","btn",Thunder.ROOT+"/gui/images/scroll_down.png","DOWN",0,0,16,16)),t}});