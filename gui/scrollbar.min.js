(function(){Thunder.Scrollbar=Thunder.Component.extend({init:function(g,e,b,c,f,a){this._super(g);this.horizontal=(a!==null)?a:false;if(b!==null){this.assetManager=b}else{this.assetManager=this.getScrollbarAssetManager()}this.width=c;this.height=f;this.value=0;this.fireUpdateOnSetValue=true;this.scrollTimer=null;this.min=0;this.max=1;this.tabSegment=0;this.increment=10;this.rectMouseDownOffSet=null;this.dragTab=false;this.name=e;this.tag="PARENT";this.layerManager.addLayer("/GUI");new Thunder.EventMap(this.container,this,this.eventQueue);var d=this;$(document).mouseup(function(h){if(d.dragTab){d.eventQueue.addEvent("WINDOW_MOUSEUP",0,d,h);return false}});$(document).mousemove(function(h){if(d.dragTab){d.eventQueue.addEvent("WINDOW_MOUSEMOVE",0,d,h);return false}});this.drawMainInterface()},drawMainInterface:function(){var a=this;this.addResponder("MOUSEDOWN",function(b){a.trace("SCROLLBAR EVENT: "+b.name+": "+b.owner.tag);switch(b.owner.tag){case"UP":if(a.scrollTimer===null){a.scrollTimer=setInterval(function(){a.handleButton(a.increment*-1)},20)}break;case"DOWN":if(a.scrollTimer===null){a.scrollTimer=setInterval(function(){a.handleButton(a.increment)},20)}break;case"RECT":case"TAB":a.dragTab=true;break}});this.addResponder("MOUSEUP",function(b){a.trace("SCROLLBAR EVENT: "+b.name+": "+b.owner.tag);if(a.scrollTimer!==null){clearInterval(a.scrollTimer);a.scrollTimer=null}a.dragTab=false;switch(b.owner.tag){case"UP":a.handleButton(a.increment*-1);break;case"DOWN":a.handleButton(a.increment);break;case"RECT":a.dragTab=false;if(a.horizontal){a.rectMouseDownOffSet=b.getLocalEventPosition().x}else{a.rectMouseDownOffSet=b.getLocalEventPosition().y}a.handleDrag();break}});this.addResponder("MOUSELEAVE",function(b){a.trace("SCROLLBAR EVENT: "+b.name+": "+b.owner.tag);switch(b.owner.tag){case"UP":case"DOWN":if(a.scrollTimer!==null){clearInterval(a.scrollTimer);a.scrollTimer=null}break}});this.addResponder("WINDOW_MOUSEUP",function(b){a.trace("SCROLLBAR EVENT: "+b.name+": "+b.owner.tag);if(a.scrollTimer!==null){clearInterval(a.scrollTimer);a.scrollTimer=null}a.dragTab=false});this.addResponder("WINDOW_MOUSEMOVE",function(c){a.trace("SCROLLBAR EVENT: "+c.name+": "+c.owner.tag);if(a.dragTab){var b=a.assetManager.getAsset("TAB");if(a.horizontal){a.rectMouseDownOffSet=c.getLocalEventPosition().x-(b.getWidth()/2)}else{a.rectMouseDownOffSet=c.getLocalEventPosition().y-(b.getHeight()/2)}a.handleDrag()}});this.addCustomizer("btn",function(d){d.attach("<img src='"+d.src+"' style='cursor:hand;cursor:pointer'/>");var c=new Thunder.EventMap(d.container.children(),d,a.eventQueue);switch(d.tag){case"DOWN":if(a.horizontal){d.setPosition(a.width-d.width,0)}else{d.setPosition(0,a.height-d.height)}break;case"TAB":var b=a.assetManager.getAsset("UP");if(a.horizontal){d.setPosition(b.getX()+b.getWidth(),0)}else{d.setPosition(0,b.getY()+b.getHeight())}break;case"RECT":var b=a.assetManager.getAsset("UP");var e=a.assetManager.getAsset("DOWN");if(a.horizontal){d.width=a.width-(b.getWidth()+e.getWidth());d.setPosition(b.getWidth(),0);d.container.children().css({width:d.getWidth(),height:a.height})}else{d.height=a.height-(b.getHeight()+e.getHeight());d.setPosition(0,b.getHeight());d.container.children().css({width:a.width,height:d.getHeight()})}break}});this.layerManager.layOut(this.assetManager.getAssets("gui","btn|mask"),"/GUI");this.setTabSegment()},handleDrag:function(){var e=this.assetManager.getAsset("RECT");var a=this.assetManager.getAsset("TAB");if(this.horizontal){if(this.rectMouseDownOffSet<e.getX()){this.rectMouseDownOffSet=e.getX()}var d=e.getX();var f=d+this.tabSegment;var g=a.getWidth()/2;for(var b=this.min;b<this.max;b++){if(this.rectMouseDownOffSet>=(d-g)&&this.rectMouseDownOffSet<=(f+g)){if(this.value!==b){this.value=b;a.setX(this.rectMouseDownOffSet);this.adjustTabPosition();this.broadcastEvent("SCROLL_UPDATE");return}}d+=this.tabSegment;if(d>=e.getWidth()){d=e.getWidth()}f=d+this.tabSegment}}else{if(this.rectMouseDownOffSet<e.getY()){this.rectMouseDownOffSet=e.getY()}var d=e.getY();var f=d+this.tabSegment;var c=a.getHeight()/2;for(var b=this.min;b<this.max;b++){if((this.rectMouseDownOffSet>=(d-c))&&(this.rectMouseDownOffSet<=(f+c))){if(this.value!==b){this.value=b;a.setY(this.rectMouseDownOffSet);this.adjustTabPosition();this.broadcastEvent("SCROLL_UPDATE");return}}d+=this.tabSegment;if(d>=e.getHeight()){d=e.getHeight()}f=d+this.tabSegment}}if(this.value!==this.max){this.value=this.max;this.adjustTabPosition();this.broadcastEvent("SCROLL_UPDATE")}},handleButton:function(b){if((this.value!==this.max&&b>0)||(this.value!==this.min&&b<0)){this.value+=b;if(this.value>this.max){this.value=this.max}else{if(this.value<this.min){this.value=this.min}}}else{return}var c=this.tabSegment*b;var a=this.assetManager.getAsset("TAB");if(this.horizontal){a.setX(a.getX()+c)}else{a.setY(a.getY()+c)}this.adjustTabPosition();this.broadcastEvent("SCROLL_UPDATE")},setTabSegment:function(){if(this.horizontal){this.tabSegment=(this.assetManager.getAsset("RECT").getWidth()-this.assetManager.getAsset("TAB").width)/(this.max-this.min)}else{this.tabSegment=(this.assetManager.getAsset("RECT").getHeight()-this.assetManager.getAsset("TAB").height)/(this.max-this.min)}},adjustTabPosition:function(){var c=this.assetManager.getAsset("RECT");var a=this.assetManager.getAsset("TAB");if(this.horizontal){var b=c.getX();var d=(c.getX()+c.getWidth())-a.getWidth();if((a.getX()<=b)){a.setX(b);this.value=this.min}if((a.getX()>=d)){a.setX(d);this.value=this.max}}else{var b=c.getY();var d=(c.getY()+c.getHeight())-a.getHeight();if(a.getY()<=b){a.setY(b);this.value=this.min}if((a.getY()>=d)){a.setY(d);this.value=this.max}}},getValue:function(){return this.value},setValue:function(b){if(isNaN(b)){return}if(this.horizontal){var a=this.assetManager.getAsset("RECT").getX()}else{var a=this.assetManager.getAsset("RECT").getY()}if(b>this.max){b=this.max}if(b<this.min){b=this.min}this.value=b;if(this.scrollTimer===null){if(this.horizontal){this.assetManager.getAsset("TAB").setX(a+(this.value-this.min)*this.tabSegment)}else{this.assetManager.getAsset("TAB").setY(a+(this.value-this.min)*this.tabSegment)}}this.adjustTabPosition();if(this.fireUpdateOnSetValue){this.broadcastEvent("SCROLL_UPDATE")}},getMin:function(){return this.min},setMin:function(a){this.min=a;this.setTabSegment();if(this.value<this.min){this.setValue(this.min)}else{this.adjustTabPosition()}},getMax:function(){return this.max},setMax:function(a){this.max=a;this.setTabSegment();if(this.value>this.max){this.setValue(this.max)}else{this.adjustTabPosition()}},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(a){if(this.width!==a){this.width=a;this.drawMainInterface()}},setHeight:function(a){if(this.height!==a){this.height=a;this.drawMainInterface()}},setIncrement:function(a){this.increment=a},getIncrement:function(){return increment},setFireUpdateOnSetValue:function(a){this.fireUpdateOnSetValue=a},getScrollbarAssetManager:function(){var a=new Thunder.AssetManager();a.addAsset("gui","btn",Thunder.ROOT+"/gui/images/scroll_rect.png","RECT");a.addAsset("gui","btn",Thunder.ROOT+"/gui/images/scroll_tab.png","TAB",0,0,16,16);if(this.horizontal){a.addAsset("gui","btn",Thunder.ROOT+"/gui/images/scroll_left.png","UP",0,0,16,16);a.addAsset("gui","btn",Thunder.ROOT+"/gui/images/scroll_right.png","DOWN",0,0,16,16)}else{a.addAsset("gui","btn",Thunder.ROOT+"/gui/images/scroll_up.png","UP",0,0,16,16);a.addAsset("gui","btn",Thunder.ROOT+"/gui/images/scroll_down.png","DOWN",0,0,16,16)}return a}})})();